<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Rakhi Celebration Room</title>
  <script type="module">
    import { HMSRoomProvider, HMSReactive, useHMSStore, selectIsConnectedToRoom, selectPeers, selectIsLocalAudioEnabled, selectIsLocalVideoEnabled, selectLocalPeer, selectIsLocalScreenShared, selectScreenShareByPeerID } from "https://unpkg.com/@100mslive/react-sdk?module";
    import { HMSPrebuilt } from "https://unpkg.com/@100mslive/roomkit-web@latest";

    document.addEventListener("DOMContentLoaded", async () => {
      const urlParams = new URLSearchParams(window.location.search);
      const roomId = urlParams.get("room");

      if (!roomId) {
        document.body.innerHTML = "<h2>No room ID provided.</h2>";
        return;
      }

      // Generate a random user ID
      const userId = "user_" + Math.floor(Math.random() * 100000);

      const response = await fetch("/.netlify/functions/generateToken", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          user_id: userId,
          room_id: roomId,
          role: "host" // or "guest"
        })
      });

      const data = await response.json();
      if (!data.token) {
        document.body.innerHTML = "<h2>Failed to fetch token.</h2>";
        return;
      }

      const room = new HMSPrebuilt();
      room.join({
        userName: "Sibling",
        authToken: data.token,
        settings: {
          isAudioMuted: false,
          isVideoMuted: false
        }
      });
    });
  </script>
</head>
<body>
  <h2 style="text-align: center;">Joining Rakhi Room...</h2>
</body>
</html></html>

