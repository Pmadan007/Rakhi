<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Raksha Bandhan Call</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://unpkg.com/@100mslive/hms-video@latest/dist/hms-video.min.js"></script>
</head>
<body>
  <div id="video-container" style="height: 100vh; background-color: #000; color: white; display: flex; align-items: center; justify-content: center;">
    Loading...
  </div>

  <script>
    const roomId = new URLSearchParams(window.location.search).get("room");
    const accessTokenEndpoint = "https://rakhi25.netlify.app/.netlify/functions/getToken"; // You'll create this

    if (!roomId) {
      document.getElementById("video-container").innerText = "❌ Room not found in URL";
      throw new Error("No room ID");
    }

    async function joinRoom() {
      const res = await fetch(accessTokenEndpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ room_id: roomId, user_id: "rakhi-user", role: "guest" })
      });

      const { token } = await res.json();

      if (!token) {
        document.getElementById("video-container").innerText = "❌ Token generation failed";
        return;
      }

      const hms = new HMSReactiveStore.HMSRoomProvider();
      await hms.join({ authToken: token, userName: "Sibling" });

      document.getElementById("video-container").innerText = "✅ Joined room (console only)";
    }

    joinRoom();
  </script>
</body>
</html>
