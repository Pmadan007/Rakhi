<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Celebrate Rakhi</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="background"></div>

  <div class="container">
    <button class="img-button" id="invite-btn">
      <img src="assets/invite-btn.png" alt="Invite Your Sibling" />
    </button>

    <div class="invite-section hidden" id="invite-section">
      <div class="link-copy">
        <input type="text" id="invite-link" readonly />
        <button id="copy-btn">Copy</button>
      </div>
      <button class="img-button hidden" id="start-btn">
        <img src="assets/start-btn.png" alt="Start Celebration" />
      </button>
    </div>
  </div>

  <!-- ✅ ADD THIS debug log box -->
  <pre id="debug" style="color: red; font-size: 14px; white-space: pre-wrap; margin: 10px;"></pre>

  <script>
    function log(msg) {
      const debugEl = document.getElementById("debug");
      if (debugEl) debugEl.textContent += `\n${msg}`;
    }

    document.addEventListener("DOMContentLoaded", () => {
      log("✅ DOM loaded");

      const inviteBtn = document.getElementById("invite-btn");
      const inviteSection = document.getElementById("invite-section");
      const inviteLink = document.getElementById("invite-link");
      const copyBtn = document.getElementById("copy-btn");
      const startBtn = document.getElementById("start-btn");

      let roomId = "";

      inviteBtn?.addEventListener("click", async () => {
        log("✅ Invite button clicked");
        const room_name = "rakhi_" + Math.random().toString(36).substring(2, 10);

        try {
          const res = await fetch("/.netlify/functions/createRoom", {
            method: "POST",
            body: JSON.stringify({ room_name }),
          });

          const data = await res.json();
          log("Room creation response: " + JSON.stringify(data));

          if (!data.id) {
            log("❌ No room ID returned.");
            return;
          }

          roomId = data.id;
          const fullLink = `${window.location.origin}/call.html?room=${roomId}`;
          inviteLink.value = fullLink;

          inviteBtn.style.display = "none";
          inviteSection.classList.remove("hidden");
          startBtn.classList.remove("hidden");
        } catch (err) {
          log("❌ Error: " + err.message);
        }
      });

      copyBtn?.addEventListener("click", () => {
        inviteLink.select();
        document.execCommand("copy");
        copyBtn.innerText = "Copied!";
        setTimeout(() => (copyBtn.innerText = "Copy"), 1500);
      });

      startBtn?.addEventListener("click", () => {
        if (roomId) {
          window.location.href = `call.html?room=${roomId}`;
        } else {
          log("❌ No roomId found!");
        }
      });
    });
  </script>
</body>
</html>    }

    document.addEventListener("DOMContentLoaded", () => {
      log("DOM loaded");

      const inviteBtn = document.getElementById("invite-btn");
      const inviteSection = document.getElementById("invite-section");
      const inviteLink = document.getElementById("invite-link");
      const copyBtn = document.getElementById("copy-btn");
      const startBtn = document.getElementById("start-btn");

      let roomId = "";

      inviteBtn?.addEventListener("click", async () => {
        log("Invite button clicked");
        const room_name = "rakhi_" + Math.random().toString(36).substring(2, 10);

        try {
          const res = await fetch("/.netlify/functions/createRoom", {
            method: "POST",
            body: JSON.stringify({ room_name }),
          });

          const data = await res.json();
          log("Room created response: " + JSON.stringify(data));

          if (!data.id) {
            log("❌ No room ID returned.");
            return;
          }

          roomId = data.id;

          const fullLink = `${window.location.origin}/call.html?room=${roomId}`;
          inviteLink.value = fullLink;

          inviteBtn.style.display = "none";
          inviteSection.classList.remove("hidden");
          startBtn.classList.remove("hidden");
        } catch (err) {
          log("❌ Error: " + err.message);
        }
      });

      copyBtn?.addEventListener("click", () => {
        inviteLink.select();
        document.execCommand("copy");
        copyBtn.innerText = "Copied!";
        setTimeout(() => (copyBtn.innerText = "Copy"), 1500);
      });

      startBtn?.addEventListener("click", () => {
        if (roomId) {
          window.location.href = `call.html?room=${roomId}`;
        } else {
          log("❌ No roomId found!");
        }
      });
    });
  </script>

</body>
</html>
